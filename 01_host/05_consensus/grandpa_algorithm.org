#+OPTIONS: toc:nil
#+Latex_Header: \usepackage{algorithm}
#+Latex_Header: \usepackage{algorithmic}
#+Latex_Header: \usepackage[font=sc]{caption}
* Play GRANDPA Round
#+BEGIN_algorithm
#+LATEX: \caption{{\textsc{Play-Grandpa-round}}}

\begin{algorithmic}[1]
\STATE $round[r] \leftarrow started$
\STATE $t_{r, v} \leftarrow$ Current local time
\STATE $\textrm{primary} \leftarrow$ \textsc{Derive-Primary}($r$)
\IF{$v = \textrm{primary}$}
  \STATE \textsc{Broadcast}$(M_{v_{\nosymbol}}^{r - 1, \textrm{Fin}}$({\textsc{Best-Final-Candidate}}($r$-1))
  \IF{\textsc{Best-Final-Candidate}$(r - 1)$ $\geqslant$ \textsc{Last-Finalized-Block}}
    \STATE \textsc{Broadcast(}$M_{v_{\nosymbol}}^{r - 1, \textrm{Prim}}$({\textsc{Best-Final-Candidate}}($r$-1)))
  \ENDIF
\ENDIF
\STATE{{\textsc{Receive-Messages}}({\bf{until}} Time $\geqslant t_{r_,v} + 2 \times T$ {\bf{or}} $r$ {\bf{is}} completable){\END}}
\STATE{$L \leftarrow${\textsc{Best-Final-Candidate}}($r$-1)}
\STATE{$N \leftarrow${\textsc{Best-PreVote-Candidate}}($r$)}
\STATE{{\textsc{Broadcast}}($M_v^{r, \textrm{pv}} (N)$)}
\STATE{{\textsc{Receive-Messages}}({\bf{until}} $B^{r,
\textrm{pv}_{\nosymbol}}_v \geqslant L$ {\bf{and}} (Time $\geqslant t_{r_,
v} + 4 \times T${\bf{ or }}$r$ {\bf{is}} completable))}
\STATE{{\textsc{Broadcast($M_v^{r, \textrm{pc}}$($B_v^{r, \textrm{pv}}$))}}}
\STATE{{\textsc{Receive-Messages}}({\bf{until}} $r$ {\bf{is}}
completable {\bf{and}} {\textsc{Finalizable}}($r$)
\qquad{\bf{and}} \
{\textsc{Last-Finalized-Block}}$\geqslant${\textsc{Best-Final-Candidate}}($r$-1))}
\STATE{{\textsc{Play-Grandpa-round}}($r + 1$)}
\STATE{{\textsc{Receive-Messages}}({\bf{until}} $round[r+2]$ {\bf{is}} started)}
\end{algorithmic}

#+end_algorithm

* Finalize
  
